### 光复唐氏

1.  在自己帮派的npc处接取. (需要判断 接取任务的时候 是否在自己帮派中)
2. ![image-20200924151926052](image-20200924151926052.png)

3. 接取成功后

![image-20200924155559329](image-20200924155559329.png)



​	4. 根据配置的数量随机任务,  根据任务类型设置 任务状态(杀怪任务设置为 **未接取**, 读条后开始倒计时,   其他设置成已经接取)

![image-20200924155613492](image-20200924155613492.png)



5. 发送界面数据.  分为助人的界面, 还是自己的界面

   自己的界面

![image-20200924160332117](image-20200924160332117.png)



​	求助的界面

![image-20200924160350973](image-20200924160350973.png)





6. **次数刷新是走 活动的重置**

![image-20200924170321358](image-20200924170321358.png)





7. 杀怪任务, 开始的时候是未接取, 当点击埋伏的时候, 任务开始.  倒计时也开始.  此时客户端发送的是开始读条请求, 可以查看GuildTransportTask.xlsx中的配置

   ​	代码快速查看(CommonStripeTypeEnum类的枚举)

![image-20200924171043221](image-20200924171043221.png)



![image-20200924173511028](image-20200924173511028.png)





8. 刷新出的怪物npc 为  **GuildTransportNpc.class** 查看里面的方法

![image-20200925115458442](image-20200925115458442.png)

以及添加到场景上面的方法

![image-20200925115521438](image-20200925115521438.png)

9. **如果是杀怪的任务,  刷完怪, 才会设置超时时间(由npc配置  getKeepTime() 控制) .    设置归属,  设置刷怪任务属性的值** 

![image-20200928113804809](image-20200928113804809.png)

杀怪的任务.怪物被击杀后, 根据仇恨对象来判**断是自己的任务, 还是求助的任务.**  如果是求助的任务, 再次处理 求助的逻辑.  

![image-20200928113508718](image-20200928113508718.png)



10. **货运任务提交. 也分为自己的和其他人的**  CSGuildTransportTaskCommit

![image-20200924173548316](image-20200924173548316.png)



11. 活动结束会重置求助次数, 并且clear 生成的Task集合

![image-20200927103301835](image-20200927103301835.png)





12. 光复大唐求助,  对话和小游戏不允许求助.  同帮派的才可以求助

![image-20200927103622421](image-20200927103622421.png)



1.  光复大唐任务求助请求  CSGuildTransportTaskForHelp

   1. 会设置超时时间.  发送给帮派频道一个求助链接(使用 FlutterManager.getInstance().sendFlutterNoticeToGuildOnlineActor)
   2. 如果是杀怪的任务. 同时还会发送一个 **SW_GUILD_TRANSPORT_TASK_FOR_HELP_REQ** 消息给world, 并将此消息转发给怪物所在的场景(因为此时玩家可能不和怪物在同一场景)
   3. ![image-20200928114311692](image-20200928114311692.png)
   4. ![image-20200928114527331](image-20200928114527331.png)

   5. 最后, 将此npc的belong属性, 修改为guild
   6. ![image-20200928114720518](image-20200928114720518.png)

![image-20200928114735297](image-20200928114735297.png)

          7.	在Actor中的canBeAttack(AbstractCharacter attacker)方法中.  会对此belong属性进行验证. 以判断对方能否被攻击
             8.	![image-20200928115025266](image-20200928115025266.png)
             9.	

