### 潜入分舵

1. 潜入分舵.
   1. 首先需要建立帮派,  回到自己帮派. 去找擂台边上的npc对话.  
   2. 点击潜入分舵后,  客户端会发送  CSAcceptLoopTask 请求
   3. 目前潜入分舵在服务器上叫做![image-20200924112319985](image-20200924112319985.png)



   4. 这样会开始下面的逻辑	

   5. ![image-20200924113503594](image-20200924113503594.png)

   6. 在world上面 随机guildId, 设置相应的值并返回 

      ![image-20200924113915690](image-20200924113915690.png)

   7. 场景上面处理这个消息, 首先设置到玩家的信息中(落地),  然后开始执行 接受这个loopId的任务方法调用

   8. ![image-20200924113953542](image-20200924113953542.png)

9. 接取任务的时候,  初始化任务数据的时候, 需要给任务目标数据额外赋值
10. ![image-20200924114217534](image-20200924114217534.png)

11. 接取成功后,  会通知world, 让world记录下  玩家id 和帮派id的对应关系. 以便处理工会解散的逻辑

![image-20200924115135690](image-20200924115135690.png)

![image-20200924115559561](image-20200924115559561.png)



12. 关于任务刷怪.  TaskModule里面有个OnEnterScene的回调. 里面有对需要刷怪任务的处理
13. ![image-20200924120038876](image-20200924120038876.png)



14.  根据存储的guildId, 刷怪
15. ![image-20200924121332245](image-20200924121332245.png)

![image-20200924121430851](image-20200924121430851.png)



接受环任务后, 会本身接取一个任务, 并且设置环任务数据 LoopTaskData.  

每一个步骤. 客户端发送CSTaskStep.

完成任务后, 跑回npc处, 客户端会发送CSCommitTask来进行完成任务提交



16.**放弃或者完成任务**

![image-20200924121753039](image-20200924121753039.png)

![image-20200924121811270](image-20200924121811270.png)



环任务次数重置刷新,   TaskModule  secondTick()

![image-20200924151559472](image-20200924151559472.png)